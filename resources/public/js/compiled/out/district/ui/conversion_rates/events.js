// Compiled by ClojureScript 1.10.238 {}
goog.provide('district.ui.conversion_rates.events');
goog.require('cljs.core');
goog.require('ajax.core');
goog.require('cljs.spec.alpha');
goog.require('clojure.string');
goog.require('day8.re_frame.http_fx');
goog.require('district.ui.conversion_rates.queries');
goog.require('district0x.re_frame.interval_fx');
goog.require('district0x.re_frame.spec_interceptors');
goog.require('goog.string');
goog.require('goog.string.format');
goog.require('re_frame.core');
district.ui.conversion_rates.events.interceptors = new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [re_frame.core.trim_v], null);
cljs.spec.alpha.def_impl.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","conversion-rates","district.ui.conversion-rates.events/conversion-rates",644300648),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","number?","cljs.core/number?",-811857295,null))),cljs.spec.alpha.every_impl.call(null,cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Symbol(null,"keyword?","keyword?",1917797069,null),cljs.core.list(new cljs.core.Symbol("s","map-of","s/map-of",-1464752791,null),new cljs.core.Symbol(null,"keyword?","keyword?",1917797069,null),new cljs.core.Symbol(null,"number?","number?",-1747282210,null))),cljs.spec.alpha.tuple_impl.call(null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","number?","cljs.core/number?",-811857295,null))], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.keyword_QMARK_,cljs.spec.alpha.every_impl.call(null,cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Symbol(null,"keyword?","keyword?",1917797069,null),new cljs.core.Symbol(null,"number?","number?",-1747282210,null)),cljs.spec.alpha.tuple_impl.call(null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","number?","cljs.core/number?",-811857295,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.keyword_QMARK_,cljs.core.number_QMARK_], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__33358){
return cljs.core.map_QMARK_.call(null,G__33358);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__22292__auto__,v__22293__auto__){
return cljs.core.nth.call(null,v__22293__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","number?","cljs.core/number?",-811857295,null))], null),null)], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__33357){
return cljs.core.map_QMARK_.call(null,G__33357);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__22292__auto__,v__22293__auto__){
return cljs.core.nth.call(null,v__22293__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","number?","cljs.core/number?",-811857295,null)))], null),null));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","start","district.ui.conversion-rates.events/start",-1825000162),district.ui.conversion_rates.events.interceptors,(function (p__33359,p__33360){
var map__33361 = p__33359;
var map__33361__$1 = ((((!((map__33361 == null)))?(((((map__33361.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33361.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33361):map__33361);
var db = cljs.core.get.call(null,map__33361__$1,new cljs.core.Keyword(null,"db","db",993250759));
var vec__33362 = p__33360;
var map__33365 = cljs.core.nth.call(null,vec__33362,(0),null);
var map__33365__$1 = ((((!((map__33365 == null)))?(((((map__33365.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33365.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33365):map__33365);
var opts = map__33365__$1;
var cache_ttl = cljs.core.get.call(null,map__33365__$1,new cljs.core.Keyword(null,"cache-ttl","cache-ttl",914328511),(180000));
return new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"db","db",993250759),district.ui.conversion_rates.queries.assoc_cache_ttl.call(null,district.ui.conversion_rates.queries.merge_conversion_rates.call(null,db,cljs.core.PersistentArrayMap.EMPTY),cache_ttl),new cljs.core.Keyword(null,"dispatch","dispatch",1319337009),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("district.ui.conversion-rates.events","watch-conversion-rates","district.ui.conversion-rates.events/watch-conversion-rates",257806915),cljs.core.merge.call(null,opts,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"id","id",-1388402092),new cljs.core.Keyword("district.ui.conversion-rates.events","start","district.ui.conversion-rates.events/start",-1825000162)], null))], null)], null);
}));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","watch-conversion-rates","district.ui.conversion-rates.events/watch-conversion-rates",257806915),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [district.ui.conversion_rates.events.interceptors,district0x.re_frame.spec_interceptors.validate_first_arg.call(null,new cljs.core.Keyword("district.ui.conversion-rates","opts","district.ui.conversion-rates/opts",572521035))], null),(function (p__33368,p__33369){
var map__33370 = p__33368;
var map__33370__$1 = ((((!((map__33370 == null)))?(((((map__33370.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33370.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33370):map__33370);
var db = cljs.core.get.call(null,map__33370__$1,new cljs.core.Keyword(null,"db","db",993250759));
var vec__33371 = p__33369;
var map__33374 = cljs.core.nth.call(null,vec__33371,(0),null);
var map__33374__$1 = ((((!((map__33374 == null)))?(((((map__33374.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33374.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33374):map__33374);
var opts = map__33374__$1;
var request_interval_ms = cljs.core.get.call(null,map__33374__$1,new cljs.core.Keyword(null,"request-interval-ms","request-interval-ms",-2134360974),(300000));
var id = cljs.core.get.call(null,map__33374__$1,new cljs.core.Keyword(null,"id","id",-1388402092));
return cljs.core.merge.call(null,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"dispatch","dispatch",1319337009),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("district.ui.conversion-rates.events","load-conversion-rates","district.ui.conversion-rates.events/load-conversion-rates",-1468965271),opts], null)], null),(((request_interval_ms > (0)))?new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"dispatch-interval","dispatch-interval",-1358911768),new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"dispatch","dispatch",1319337009),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("district.ui.conversion-rates.events","load-conversion-rates","district.ui.conversion-rates.events/load-conversion-rates",-1468965271),opts], null),new cljs.core.Keyword(null,"id","id",-1388402092),id,new cljs.core.Keyword(null,"ms","ms",-1152709733),request_interval_ms], null)], null):null));
}));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","stop-watching-conversion-rates","district.ui.conversion-rates.events/stop-watching-conversion-rates",-441888510),district.ui.conversion_rates.events.interceptors,(function (p__33377,p__33378){
var map__33379 = p__33377;
var map__33379__$1 = ((((!((map__33379 == null)))?(((((map__33379.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33379.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33379):map__33379);
var db = cljs.core.get.call(null,map__33379__$1,new cljs.core.Keyword(null,"db","db",993250759));
var vec__33380 = p__33378;
var id = cljs.core.nth.call(null,vec__33380,(0),null);
return new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"clear-interval","clear-interval",-68384603),new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"id","id",-1388402092),id], null)], null);
}));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","load-conversion-rates","district.ui.conversion-rates.events/load-conversion-rates",-1468965271),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [district.ui.conversion_rates.events.interceptors,district0x.re_frame.spec_interceptors.validate_first_arg.call(null,new cljs.core.Keyword("district.ui.conversion-rates","opts","district.ui.conversion-rates/opts",572521035))], null),(function (p__33384,p__33385){
var map__33386 = p__33384;
var map__33386__$1 = ((((!((map__33386 == null)))?(((((map__33386.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33386.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33386):map__33386);
var db = cljs.core.get.call(null,map__33386__$1,new cljs.core.Keyword(null,"db","db",993250759));
var vec__33387 = p__33385;
var map__33390 = cljs.core.nth.call(null,vec__33387,(0),null);
var map__33390__$1 = ((((!((map__33390 == null)))?(((((map__33390.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33390.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33390):map__33390);
var from_currencies = cljs.core.get.call(null,map__33390__$1,new cljs.core.Keyword(null,"from-currencies","from-currencies",1794066200));
var to_currencies = cljs.core.get.call(null,map__33390__$1,new cljs.core.Keyword(null,"to-currencies","to-currencies",1238261786));
var request_timeout = cljs.core.get.call(null,map__33390__$1,new cljs.core.Keyword(null,"request-timeout","request-timeout",-2047539823),(10000));
if(((cljs.core.seq.call(null,from_currencies)) && (cljs.core.seq.call(null,to_currencies)) && (cljs.core.not.call(null,district.ui.conversion_rates.queries.cache_has_all_pairs_QMARK_.call(null,db,from_currencies,to_currencies))))){
return new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"http-xhrio","http-xhrio",1846166714),new cljs.core.PersistentArrayMap(null, 6, [new cljs.core.Keyword(null,"method","method",55703592),new cljs.core.Keyword(null,"get","get",1683182755),new cljs.core.Keyword(null,"uri","uri",-774711847),goog.string.format("https://min-api.cryptocompare.com/data/pricemulti?fsyms=%s&tsyms=%s",clojure.string.join.call(null,",",cljs.core.map.call(null,cljs.core.name,from_currencies)),clojure.string.join.call(null,",",cljs.core.map.call(null,cljs.core.name,to_currencies))),new cljs.core.Keyword(null,"timeout","timeout",-318625318),request_timeout,new cljs.core.Keyword(null,"response-format","response-format",1664465322),ajax.core.json_response_format.call(null,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"keywords?","keywords?",764949733),true], null)),new cljs.core.Keyword(null,"on-success","on-success",1786904109),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("district.ui.conversion-rates.events","set-conversion-rates","district.ui.conversion-rates.events/set-conversion-rates",-852793266)], null),new cljs.core.Keyword(null,"on-failure","on-failure",842888245),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("district.ui.conversion-rates.events","conversion-rates-load-failed","district.ui.conversion-rates.events/conversion-rates-load-failed",-1393032646)], null)], null),new cljs.core.Keyword(null,"db","db",993250759),district.ui.conversion_rates.queries.update_cache.call(null,db,from_currencies,to_currencies)], null);
} else {
return null;
}
}));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","set-conversion-rates","district.ui.conversion-rates.events/set-conversion-rates",-852793266),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [district.ui.conversion_rates.events.interceptors,district0x.re_frame.spec_interceptors.validate_first_arg.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","conversion-rates","district.ui.conversion-rates.events/conversion-rates",644300648))], null),(function (p__33393,p__33394){
var map__33395 = p__33393;
var map__33395__$1 = ((((!((map__33395 == null)))?(((((map__33395.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33395.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33395):map__33395);
var db = cljs.core.get.call(null,map__33395__$1,new cljs.core.Keyword(null,"db","db",993250759));
var vec__33396 = p__33394;
var conversion_rates = cljs.core.nth.call(null,vec__33396,(0),null);
return new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"db","db",993250759),district.ui.conversion_rates.queries.merge_conversion_rates.call(null,db,conversion_rates)], null);
}));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","conversion-rates-load-failed","district.ui.conversion-rates.events/conversion-rates-load-failed",-1393032646),cljs.core.constantly.call(null,null));
re_frame.core.reg_event_fx.call(null,new cljs.core.Keyword("district.ui.conversion-rates.events","stop","district.ui.conversion-rates.events/stop",-914452925),district.ui.conversion_rates.events.interceptors,(function (p__33400){
var map__33401 = p__33400;
var map__33401__$1 = ((((!((map__33401 == null)))?(((((map__33401.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__33401.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.call(null,cljs.core.hash_map,map__33401):map__33401);
var db = cljs.core.get.call(null,map__33401__$1,new cljs.core.Keyword(null,"db","db",993250759));
return new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"db","db",993250759),district.ui.conversion_rates.queries.dissoc_conversion_rates.call(null,db),new cljs.core.Keyword(null,"clear-interval","clear-interval",-68384603),new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"id","id",-1388402092),new cljs.core.Keyword("district.ui.conversion-rates.events","start","district.ui.conversion-rates.events/start",-1825000162)], null)], null);
}));

//# sourceMappingURL=events.js.map?rel=1526705067652
